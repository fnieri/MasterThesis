
\part{Source Code Appendix}

\chapter{Grammar} \label{app:grammar}
This is the grammar for the ANTLR4 parser.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/parser/DQGrammar.g4}

\chapter{C++ Source Files}

\section{Root folder}

\subsection{main.cpp}
This is the main file of the project.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/main.cpp}

\subsection{Application.cpp}

This is a singleton that handles the global state of the application.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/Application.cpp}


\section{Dashboard}
This folder contains the widgets that compose the dashboard.

\subsection{ColorRegistry.cpp} \label{code:coder}
\sloppy This class stores all the colors for all the QtSeries, moreover, it generates HSV colors based on the algorithm taken from \url{https://martin.ankerl.com/2009/12/09/how-to-create-random-colors-programmatically/}.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/ColorRegistry.cpp}

\subsection{CustomLegendEntry.cpp} \label{code:cle}
This class represents an entry in the plot legend.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/CustomLegendEntry.cpp}

\subsection{CustomLegendPanel.cpp} \label{code:clp}
This widget represents the legend panel for a plot, with entries corresponding to each series.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/CustomLegendPanel.cpp}

\subsection{DQPlotController.cpp} \label{code:dqpc}
This class is the controller of DeltaQPlot, based on the MVC design pattern.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/DQPlotController.cpp}

\subsection{DQPlotList.cpp} \label{code:dqpl}
This widget handles the adding and removing of probes series from a plot.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/DQPlotList.cpp}

\subsection{DelaySettingsWidget.cpp} \label{code:dsw}
This widget represent the slider widget to modify the parameters $dMax$, $\Delta$t and N.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/DelaySettingsWidget.cpp}

\subsection{DeltaQPlot.cpp} \label{code:dqp}
This widget is the widget containing a plot and its legend.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/DeltaQPlot.cpp}

\subsection{MainWindow.cpp} \label{code:mw}
This widget is the main window of the application, it has a tab to the side where the widgets to control the oscilloscope are. To the left, the panel where all plots are shown.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/MainWindow.cpp}

\subsection{NewPlotList.cpp} \label{code:npl}
This widget is the widget to add a new plot to the plots panel.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/NewPlotList.cpp}

\subsection{ObservableSettings.cpp} \label{code:os}
This widget is a tab that contains the settings for the probes (Setting a QTA, setting $dMax$).
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/ObservableSettings.cpp}

\subsection{SamplingRateWidget.cpp} \label{code:srw}
This widget allows the sampling rate to be changed via a slider.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/SamplingRateWidget.cpp}

\subsection{QTAInputWidget.cpp} \label{code:qiw}
This widget allows the QTA to be set for a probe
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/QTAInputWidget.cpp}

\subsection{Sidebar.cpp} \label{code:side}
This widget is a tab where the user can handle the system, add/remove plots and change the sampling rate.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/Sidebar.cpp}

\subsection{SnapshotViewerWindow.cpp} \label{code:svw}
This is a window to observe a snapshot from the triggers tab.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/SnapshotViewerWindow.cpp}

\subsection{StubControlWidget.cpp} \label{code:scw}
This widget allows to open the server on the IP and Port defined by the user and to connect to the adapter on the IP and port specified by the user.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/StubControlWidget.cpp}

\subsection{SystemCreationWidget.cpp} \label{code:syscw}
This widget allows the creation/update of a system, loading an already existing one or saving one.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/SystemCreationWidget.cpp}

\subsection{TriggersTab.cpp} \label{code:tt}
This tab holds the widgets to set/remove triggers and view fired ones. 
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/TriggersTab.cpp}

\section{Outcome diagram}

The "diagram" folder contains everything related to outcome diagrams. Due to time related issues, there are some issues with the names. We will explain what each class represents, but it differs from the definitions which are explained in the thesis.

\subsection{Observable.cpp} \label{code:obs}
The observable class represents a generic "observable" element of the outcome diagram, it is the base class for probes, outcome and operators. In this class one can calculate the observed $\Delta$Q, store the outcome instances (samples), set the parameters, set a QTA, add/remove triggers and get a snapshot. It is what we described throughout the whole paper as a probe.

\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/Observable.cpp}
\subsection{Operator.cpp} \label{code:op}
This class represent a generic operator, it can be either an FTF, ATF or PC. It allows calculating the "calculated $\Delta$Q".
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/Operator.cpp}

\subsection{Outcome.cpp} \label{code:outc}
This class represents a simple outcome.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/Outcome.cpp}

\subsection{Probe.cpp} \label{code:probe}
This class represents what we described as "sub-outcome diagram". As the operator class, it allows calculating the "calculated $\Delta$Q".
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/Probe.cpp}

\subsection{System.cpp} \label{code:sys}
This class represents the system, the whole outcome diagram. It coordinates the various parts of the outcome diagram.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/System.cpp}

\section{$\Delta$Q (maths)}
The "maths" folder represents all the classes related to $\Delta$Q, where mathematical operations are being done (hence the "maths" name).

\subsection{ConfidenceInterval.cpp} \label{code:ci}
This class represents the confidence bounds described earlier.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/ConfidenceInterval.cpp}

\subsection{DeltaQ.cpp} \label{code:dq}
This class represents a $\Delta$Q. It supports calculating a $\Delta$Q given multiple samples, calculating the quartiles of a $\Delta$Q, it supports various arithmetical transformations.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/DeltaQ.cpp}

\subsection{DeltaQOperations.cpp} \label{code:dqop}
This file contains the definition of all the operations that can be done on a $\Delta$Q or on $\Delta$Qs, specified in the implementation chapter. Convolution (naive, FFT), FTF, ATF, PC operators, rebinning.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/DeltaQOperations.cpp}

\subsection{Snapshot.cpp} \label{code:snaps}
This class represents a single snapshot of a probe. It contains the QTA, observable $\Delta$Q and calculated $\Delta$Q at time t.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/Snapshot.cpp}

\subsection{TriggerManager.cpp} \label{code:trigman}
This class is the manager of triggers for a probe. It can add/remove/evaluate triggers.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/TriggerManager.cpp}

\subsection{Triggers.cpp} \label{code:trigg}
This class contains the conditions of the triggers selected by the user. The trigger manager evaluates the conditions at runtime. The Actions namespace is WIP.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/Triggers.cpp}

\section{parser}

\subsection{SystemBuilder.cpp} \label{code:sysb}
This class builds a new outcome diagram (system class) given an AST built when parsing.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/parser/SystemBuilder.cpp}

\subsection{SystemParserInterface.cpp} \label{code:syspi}
This files contains functions to be called by the dashboard to avoid communicating directly to ANTLR. It throws errors which are caught by the caller if the parsing was unsuccessful.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/parser/SystemParserInterface.cpp}

\section{server}

\subsection{Server.cpp} \label{code:serv}
This class represents the server which receives and sends messages from Erlang.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/server/Server.cpp}

\chapter{C++ Header Files}

\section{Root}

\subsection{Application.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/Application.h}

\section{dashboard}

\subsection{ColorRegistry.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/ColorRegistry.h}

\subsection{CustomLegendEntry.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/CustomLegendEntry.h}

\subsection{CustomLegendPanel.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/CustomLegendPanel.h}

\subsection{DQPlotController.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/DQPlotController.h}

\subsection{DQPlotList.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/DQPlotList.h}

\subsection{DelaySettingsWidget.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/DelaySettingsWidget.h}

\subsection{DeltaQPlot.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/DeltaQPlot.h}

\subsection{MainWindow.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/MainWindow.h}

\subsection{NewPlotList.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/NewPlotList.h}

\subsection{ObservableSettings.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/ObservableSettings.h}

\subsection{SamplingRateWidget.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/SamplingRateWidget.h}

\subsection{QTAInputWidget.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/QTAInputWidget.h}

\subsection{Sidebar.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/Sidebar.h}

\subsection{SnapshotViewerWindow.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/SnapshotViewerWindow.h}

\subsection{StubControlWidget.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/StubControlWidget.h}

\subsection{SystemCreationWidget.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/SystemCreationWidget.h}

\subsection{TriggersTab.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/dashboard/TriggersTab.h}

\section{diagram}

\subsection{Observable.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/Observable.h}

\subsection{Operator.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/Operator.h}

\subsection{OperatorType.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/OperatorType.h}

\subsection{Outcome.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/Outcome.h}

\subsection{Probe.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/Probe.h}

\subsection{Sample.h}
This struct represents an outcome instance.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/Sample.h}

\subsection{System.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/diagram/System.h}

\section{$\Delta$Q (maths)}

\subsection{ConfidenceInterval.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/ConfidenceInterval.h}

\subsection{DeltaQ.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/DeltaQ.h}

\subsection{DeltaQOperations.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/DeltaQOperations.h}

\subsection{DeltaQRepr.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/DeltaQRepr.h}

\subsection{QTA.h}
This class represent a sample QTA.
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/QTA.h}

\subsection{Snapshot.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/Snapshot.h}

\subsection{TriggerManager.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/TriggerManager.h}

\subsection{TriggerTypes.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/TriggerTypes.h}

\subsection{Triggers.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/maths/Triggers.h}

\section{parser}

\subsection{SystemBuilder.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/parser/SystemBuilder.h}

\subsection{SystemErrorListener.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/parser/SystemErrorListener.h}

\subsection{SystemParserInterface.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/parser/SystemParserInterface.h}

\section{server}

\subsection{Server.h}
\lstinputlisting[style=mystyle, language=C++]{../RealTimeDeltaQSD/src/server/Server.h}

\chapter{Build Configuration Files}

\section{src/CMakeLists.txt}
\lstinputlisting[style=mystyle, ]{../RealTimeDeltaQSD/src/CMakeLists.txt}

\section{dashboard/CMakeLists.txt}
\lstinputlisting[style=mystyle, ]{../RealTimeDeltaQSD/src/dashboard/CMakeLists.txt}

\section{diagram/CMakeLists.txt}
\lstinputlisting[style=mystyle, ]{../RealTimeDeltaQSD/src/diagram/CMakeLists.txt}

\section{maths/CMakeLists.txt}
\lstinputlisting[style=mystyle, ]{../RealTimeDeltaQSD/src/maths/CMakeLists.txt}

\section{parser/CMakeLists.txt}
\lstinputlisting[style=mystyle, ]{../RealTimeDeltaQSD/src/parser/CMakeLists.txt}

\section{server/CMakeLists.txt}
\lstinputlisting[style=mystyle, ]{../RealTimeDeltaQSD/src/server/CMakeLists.txt}

\chapter{Erlang Source Files}

\section{Root}

\subsection{dqsd\_otel.erl}
The $\Delta$Q adapter, it can start, fail, end spans and start and end with\_spans, communicates to the TCP client to send outcome instances to the oscilloscope.
\lstinputlisting[style=mystyle, language=erlang]{../dqsd_otel/src/dqsd_otel.erl}

\subsection{dqsd\_otel\_app.erl}
\lstinputlisting[style=mystyle, language=erlang]{../dqsd_otel/src/dqsd_otel_app.erl}

\subsection{dqsd\_otel\_sup.erl}
The supervisor of the adapter. It start the TCP server, client and adapter.
\lstinputlisting[style=mystyle, language=erlang]{../dqsd_otel/src/dqsd_otel_sup.erl}

\subsection{dqsd\_otel\_tcp\_client.erl}
The TCP client, it can send outcome instances to the oscilloscope.
\lstinputlisting[style=mystyle, language=erlang]{../dqsd_otel/src/dqsd_otel_tcp_client.erl}

\subsection{dqsd\_otel\_tcp\_server.erl}
The TCP server accepts messages from the oscilloscope and forwards them to the adapter to set the various settings.
\lstinputlisting[style=mystyle, language=erlang]{../dqsd_otel/src/dqsd_otel_tcp_server.erl}

\chapter{Erlang Application Files}

\section{Root}

\subsection{dqsd\_otel.app.src}
The app.src file of the adapter.
\lstinputlisting[style=mystyle, language=erlang]{../dqsd_otel/src/dqsd_otel.app.src}

\chapter{Synthetic Applications}

\section{Synthetic applications} \label{app:synte}
\subsection{M/M/1/K queue application} \label{app:mm1k}

\lstinputlisting[style=mystyle, language=erlang]{../RealTimeDeltaQSD/otel_getting_started/apps/otel_getting_started/src/mm1k.erl}

\subsection{First to finish application} \label{app:ftf}

\lstinputlisting[style=mystyle, language=erlang]{../RealTimeDeltaQSD/otel_getting_started/apps/otel_getting_started/src/ftf.erl}

\subsection{All to finish application} \label{app:atf}

\lstinputlisting[style=mystyle, language=erlang]{../RealTimeDeltaQSD/otel_getting_started/apps/otel_getting_started/src/atf.erl}



